<div class="reservations-container">
  <!-- Main Content -->
  <div class="content-wrapper">
    <!-- Title Section -->
    <div class="section-header">
      <div class="title-group">
        <i class="section-icon">üìã</i>
        <div>
          <h2>Reservas</h2>
          <p class="subtitle">Gestiona las reservas de los clientes</p>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'pendientes'"
        (click)="switchTab('pendientes')">
        Pendientes
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'confirmadas'"
        (click)="switchTab('confirmadas')">
        Confirmadas por m√≠
      </button>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
      <div class="search-box">
        <i class="search-icon">üîç</i>
        <input 
          type="text" 
          placeholder="Buscar reserva por nombre, email, tel√©fono o fecha..."
          [(ngModel)]="searchTerm"
          (input)="searchReservations()"
          class="search-input">
      </div>
    </div>

    <!-- Results Count -->
    <p class="results-count">
      Mostrando {{ filteredReservations.length }} de {{ reservations.length }} reservas
    </p>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Cargando reservas...</p>
    </div>

    <!-- Table -->
    <div *ngIf="!loading" class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>CLIENTE</th>
            <th>FECHA</th>
            <th>HORA</th>
            <th>PERSONAS</th>
            <th>CONTACTO</th>
            <th>ESTADO</th>
            <th *ngIf="activeTab === 'confirmadas'">MESA</th>
            <th>ACCIONES</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let reservation of filteredReservations">
            <td>{{ reservation.idReservation }}</td>
            <td>
              <div class="customer-info">
                <strong>{{ reservation.customerName }}</strong>
              </div>
            </td>
            <td>{{ formatDate(reservation.reservationDate) }}</td>
            <td>{{ formatTime(reservation.reservationTime) }}</td>
            <td>
              <span class="people-badge">üë• {{ reservation.numPeople }}</span>
            </td>
            <td>
              <div class="contact-info">
                <div>üìß {{ reservation.customerEmail }}</div>
                <div>üì± {{ reservation.customerPhone }}</div>
              </div>
            </td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(reservation.status)">
                {{ getStatusText(reservation.status) }}
              </span>
            </td>
            <td *ngIf="activeTab === 'confirmadas'">
              <span *ngIf="reservation.table" class="table-badge">
                Mesa {{ reservation.table.tableNumber }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button 
                  class="btn-action btn-view" 
                  (click)="openViewModal(reservation)"
                  title="Ver detalles">
                  üëÅÔ∏è
                </button>
                <button 
                  *ngIf="activeTab === 'pendientes'"
                  class="btn-action btn-confirm" 
                  (click)="openConfirmModal(reservation)"
                  title="Confirmar reserva">
                  ‚úÖ
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="filteredReservations.length === 0" class="empty-state">
        <p>üì≠ No hay reservas {{ activeTab === 'pendientes' ? 'pendientes' : 'confirmadas' }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Confirmaci√≥n -->
<div *ngIf="showConfirmModal" class="modal-overlay" (click)="closeConfirmModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Confirmar Reserva</h3>
      <button class="btn-close" (click)="closeConfirmModal()">‚úñÔ∏è</button>
    </div>

    <div class="modal-body">
      <div class="reservation-summary">
        <h4>Informaci√≥n de la Reserva</h4>
        <div class="info-grid">
          <div class="info-item">
            <label>Cliente:</label>
            <span>{{ selectedReservation?.customerName }}</span>
          </div>
          <div class="info-item">
            <label>Fecha:</label>
            <span>{{ formatDate(selectedReservation?.reservationDate || '') }}</span>
          </div>
          <div class="info-item">
            <label>Hora:</label>
            <span>{{ formatTime(selectedReservation?.reservationTime || '') }}</span>
          </div>
          <div class="info-item">
            <label>Personas:</label>
            <span>{{ selectedReservation?.numPeople }}</span>
          </div>
        </div>
        <div *ngIf="selectedReservation?.specialNotes" class="special-notes">
          <label>Notas del cliente:</label>
          <p>{{ selectedReservation?.specialNotes }}</p>
        </div>
      </div>

      <div class="form-group">
        <label for="tableSelect">Seleccionar Mesa *</label>
        <select 
          id="tableSelect"
          [(ngModel)]="confirmRequest.idTable"
          class="form-control"
          required>
          <option [value]="0" disabled>-- Seleccione una mesa --</option>
          <option 
            *ngFor="let table of availableTables" 
            [value]="table.idTable">
            Mesa {{ table.tableNumber }} - Capacidad: {{ table.capacity }} personas
            <span *ngIf="table.location"> ({{ table.location }})</span>
          </option>
        </select>
        <p *ngIf="availableTables.length === 0" class="warning-text">
          ‚ö†Ô∏è No hay mesas disponibles para esta fecha y hora con capacidad suficiente
        </p>
      </div>

      <div class="form-group">
        <label for="notes">Notas de confirmaci√≥n (opcional)</label>
        <textarea 
          id="notes"
          [(ngModel)]="confirmRequest.notes"
          class="form-control"
          rows="3"
          placeholder="Ej: Mesa junto a la ventana, cerca de la entrada, etc."></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeConfirmModal()">
        Cancelar
      </button>
      <button 
        class="btn btn-primary" 
        (click)="confirmReservation()"
        [disabled]="!confirmRequest.idTable || loading">
        {{ loading ? 'Confirmando...' : 'Confirmar Reserva' }}
      </button>
    </div>
  </div>
</div>

<!-- Modal de Vista Detallada -->
<div *ngIf="showViewModal" class="modal-overlay" (click)="closeViewModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Detalles de la Reserva #{{ viewReservation?.idReservation }}</h3>
      <button class="btn-close" (click)="closeViewModal()">‚úñÔ∏è</button>
    </div>

    <div class="modal-body">
      <div class="detail-section">
        <h4>Informaci√≥n del Cliente</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>Nombre:</label>
            <span>{{ viewReservation?.customerName }}</span>
          </div>
          <div class="detail-item">
            <label>Email:</label>
            <span>{{ viewReservation?.customerEmail }}</span>
          </div>
          <div class="detail-item">
            <label>Tel√©fono:</label>
            <span>{{ viewReservation?.customerPhone }}</span>
          </div>
        </div>
      </div>

      <div class="detail-section">
        <h4>Informaci√≥n de la Reserva</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>Fecha:</label>
            <span>{{ formatDate(viewReservation?.reservationDate || '') }}</span>
          </div>
          <div class="detail-item">
            <label>Hora:</label>
            <span>{{ formatTime(viewReservation?.reservationTime || '') }}</span>
          </div>
          <div class="detail-item">
            <label>Personas:</label>
            <span>{{ viewReservation?.numPeople }}</span>
          </div>
          <div class="detail-item">
            <label>Estado:</label>
            <span class="status-badge" [ngClass]="getStatusClass(viewReservation?.status || 'PENDIENTE')">
              {{ getStatusText(viewReservation?.status || 'PENDIENTE') }}
            </span>
          </div>
        </div>
      </div>

      <div *ngIf="viewReservation?.table" class="detail-section">
        <h4>Mesa Asignada</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>Mesa:</label>
            <span>Mesa {{ viewReservation?.table?.tableNumber }}</span>
          </div>
          <div class="detail-item">
            <label>Capacidad:</label>
            <span>{{ viewReservation?.table?.capacity }} personas</span>
          </div>
          <div *ngIf="viewReservation?.table?.location" class="detail-item">
            <label>Ubicaci√≥n:</label>
            <span>{{ viewReservation?.table?.location }}</span>
          </div>
        </div>
      </div>

      <div *ngIf="viewReservation?.specialNotes" class="detail-section">
        <h4>Notas del Cliente</h4>
        <p class="notes-text">{{ viewReservation?.specialNotes }}</p>
      </div>

      <div *ngIf="viewReservation?.responseNotes" class="detail-section">
        <h4>Notas de Confirmaci√≥n</h4>
        <p class="notes-text">{{ viewReservation?.responseNotes }}</p>
      </div>

      <div *ngIf="viewReservation?.attendedBy" class="detail-section">
        <h4>Atendido Por</h4>
        <p>{{ viewReservation?.attendedBy?.idUser }}</p>
      </div>

      <div class="detail-section">
        <h4>Fechas del Sistema</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label>Creada:</label>
            <span>{{ formatDate(viewReservation?.createdAt || '') }}</span>
          </div>
          <div class="detail-item">
            <label>Actualizada:</label>
            <span>{{ formatDate(viewReservation?.updatedAt || '') }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeViewModal()">
        Cerrar
      </button>
    </div>
  </div>
</div>